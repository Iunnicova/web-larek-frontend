# Проектная работа "Веб-ларек"

##### Ссылка на сайт

https://github.com/Iunnicova/web-larek-frontend.git

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

---

## Данные и типы данных использумые в приложении

Каталог продукции

```
 interface IProductCatalog {
	id: string;
	description: string;
	category: string;
	image: string;
	title: string;
	button: string;
	price: number | null;
}
```

Пользовательские данные

```
 interface IUserData {
	id: string;
	payment: string;
	title: string;
	address: string;
	email: string | number;
	phone: number;
}
```

### Интерфейс для хранения каталога карточек с товаром

```
 interface IProductData {
	Product: IProductCatalog;
	preview: string | null;
	addProduct(product: IProductCatalog): void;
	deleteProduct(productId: string, payload: Function | null): void;
	getProducts(productId: string): IProductCatalog;
}
```

## Интерфейс для хранения данных пользователя

```
 interface IUserData {
 getUserInfo(): TDataСustomer;
 setUserInfo(userData: IUser): void;
 checkUserValid(data:Record<keyof TDataСustomer, string>):  boolean;
}
```

## Интерфейс для класса отображения

interface IView {
render(data?:object): HTMLElement;
}

```
## Интерфейс карзины

```

interface IBasked {
items: Map<string, number>;
add (id: string): void;
remove (id: string): void;
total: number;
}

```
## Интерфейс Модели для хранения данных товара
 interface ICatalogModel {
	items: IProduct;
	setItems(items: IProduct[]): void;
	getProduct(id: string):IProduct;
}

```

Информация о продукте(товаре)

```

type TroductInformation = Pick<IProductCatalog, 'image' | 'description' | 'category' | 'title' | 'price'>;

```

Форма для оплаты

```

type TPaymentForm = Pick<IUserData, 'address' | 'button'>;

```

Контактная информация

```

type TContactForm = Pick<IUserData, 'email' | 'phone' | 'button'>;

```

Завершение покупки

```

type TSuccessfulPurchase = Pick<IProductCatalog, 'title' | 'price' | 'button'>;

```

## Архитектура приложения

Код разделен на слои MVP:

- слой представления, отвечает за отображение данных на странице.
- слой данных, отвечает за хранение и изменения данных.
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

#### Класс Component

Класс для работы с DOM в дочерних компонентах- обеспечивает базовый функционал для создания и управления элементами интерфейса.\
 Конструктор инициализирует свойство с помощью HTMLElement.\
 Метод `render` возвращает новый HTMLElement с заполнеными данными.

### Слой данных

#### Класс ProductData

Отвечает за хранение и логику работы с катологом товара. Конструктор класса принимает instant брокера событий.\
В полях класса хранятся:\

- ` _product: IProductCatalog[]` - массив объекта товаров\
- `_preview: string | null` - id товара, выбранного для просмотра в модальном окне\
- ` events: IEvents` - экземпляр класса EventEmitter будет использоватся для генерации событий\

Класс предоставляет методы для взаимодейстия с данными.

- ` addProduct(product: IProductCatalog): void` - добавляет один товар в массив, и вызывает события изменения массива\
- ` deleteProduct(productId: string, payload: Function | null): void` - удаляет товар из массива. Если передан колбэк, то выполняет его после удаления, если нет, то вызывает событие изменения массива.\
- ` getProducts(productId: string): IProductCatalog` - возвращает товаз по ее id\

- а так же сеттеры и геттеры для сохранения и получения данных из полей класса.

  #### класс UserData

  Отвечает за хранение и логику работы с данными пользователя.\
  Конструктор класса принимает instant брокера србытий\
   В полях класса хранятся:

- `_id: string` - уникальный идентификатор\
- `payment: string` - оплата товара\
- `title: string` - текст\
- `address: string` - адрес покупателя\
- `email: string | number` - email поккупателя\
- `phone: number` - номер контактных ланных\
  Класс предоставляет набор методов для взаимодействия с данными:
- `getUserInfo(): TDataСustomer` - возвращает данные покупателя\
- `setUserInfo(userData: IUser): void `- сохраняет данные пользователя\
- `- checkUserValid(data:Record<keyof TDataСustomer, string>): boolean `- проверяет объект с данными на .

#### Класс ProductForm

Класс предназначен для обработки взаимодействия с формами,\расширяющий компонент Component\

- `_submit`- cсылка на кнопку «Отправить» в форме.\
- `_errors` - cсылка на элемент HTML, предназначенный для отображения ошибок формы.\
  Конструктор :инициализирует форму, настраивая ссылки на кнопку отправки и элемент отображения ошибок.
  Добавляет прослушиватели событий для ввода данных в форму для обработки изменений и отправки форм.\
  Сеттеры :\
- `valid`- включает или отключает кнопку «Отправить» в зависимости от действительности формы.\
- `errors` - Обновляет текст элемента отображения ошибок.\
- `render` - обновляет состояние формы и перерисовывает ее.

### Класс View

класс отображения элементов\

- `render(data?:object): HTMLElement` - получает данные и возвращает HTMLElementразметки с заполнеными данными

### Классы представления

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

### Класс CatalogModel

- `setItems(items: IProduct[]): void`- метод для сохранения списка получив его с сервера.\
- `getProduct(id: string):IProduct`- метод для получения списка товаров при необходимости

#### Класс Modal

Pасширяет базовый класс `Component`
Реализует модальное окно.\
 Предоставляет методы `open` и `close` они открывают и закрывают модальные окна.\

- `_set` - заменяет содержимое модального окна. Устанавливает слушатель на клик для закрытия модального окна в оверлей и кнопку-крестик\
- `render` — передает данные о контенте.\
- `createElement("div")`- Элемент для отображения содержимого, будет использоваться в качестве модального окна в который будет выводится контент\
  Поля класса\
- `modal`: HTMLElement - элемент модального окна\
- `events`: IEvents - брокер событий.

#### Класс ProductCatalog

Отвечает за отображение товара, задавая в карточке товара данные названия, изображения, стоимость. Класс используется для отображения карточек товара на странице сайта. В конструктор класса передается DOM элемент темплейта. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
`constructor` принимает параметр template и присваивает его значение полю\
Поля класса:\

- `template` - темплейт карточки с товаром.\
- `nameElement` - отображения названия товара.\
- `imageElement` - отображения изображения цвета.\
- `priceElement` - отображения стоимости товара.\
  Метод:\
- `setProduct` - устанавливает данные о продукте в шаблоне.\
- `addEventListener()` - добавляет обработчики событий к интерактивным элементам шаблона.\
- `userInteraction()` определяют логику обработки событий, связанных с взаимодействием пользователя с продуктом.\

#### Класс Basket

Класс отвечает за отправление товара в карзину.\
Методы:\

- `items: Map<string, number>` - хранения товара и его колличества, товар не должен повторятся\
- `add (id: string): void` - добавления товара +1\
- `remove (id: string): void` - удаления товара -1\
- ` _changed` - генерирует уведомление об изменении\
  Конструктор принимает родительский элемент и обработчик событий.

#### Класс ContactForm

Класс устанавливает значения полей телефона и электронной почты в форме
Включает в себя информацию о контактах покупателя, при неверном заполнение выскакивает ошибка\

- `email: string | number` - email покупателя устанавливает значение поля ввода с именем «email» в соответствии с предоставленным значением value.
- `phone: number` - контактный номер покупателя устанавливает значение поля ввода с именем «телефон» в соответствии с предоставленным значением value.\
  Конструктор принимает два параметра:\
   `containertype HTMLFormElementи`\
   `eventstype IEvents`.\
  Он вызывает конструктор родительского класса ProductForm теми же параметрами.

#### Класс PaymentForm

модальное окно для выбора способа оплаты.\
Он включает в себя поле для ввода адреса доставки, при неверном запонение выскакивает сообщение об ошибке.\

- ` address: string` - адрес доставки\
- `submitForm()`- Метод проверяет, заполнены ли поля формы. Если поле address не заполнено, то выводится сообщение об ошибке.

#### Класс SuccessfulPurchase

включает в себя форму списание счета и успешной покупки\

- `title: string` - текст о завершение оплаты\
- `price: number | null` - списанные синапсы\
- `button: string` - за новыми покупками

### Слой коммуникации

#### Класс ProductApi

Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой находится в файле index.ts, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в index.ts\
В index.ts сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

- `user:changed` - изменение данных пользователя
- `cards:changed` - изменение массива карточек продукта
- `card":selected` - изменение открываемой в модальном окне картинки продукта
- `card"previewClear` - необходима очистка данных выбранной для показа в модальном окне продукта
- `userEdit:open` - открытие модального окна с формой редактирования данных покупателя
- `card":select` - выбор карточки товара для отображения в модальном окне
- `card":delete` - выбор карточки товара для удаления
- `order-profile:input` - изменение данных в форме оплаты пользователя
- `address-profile:input` - ввод адреса пользователя в модальном окне
- `еmail-contacts:validation` - ввод Email пользователя в модальном окне
- `phone-contacts:input` - ввод номера телефона пользователя в модальном окне
