# Проектная работа "Веб-ларек"

##### Ссылка на сайт

https://github.com/Iunnicova/web-larek-frontend.git


Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

---

## Данные и типы данных использумые в приложении

Каталог продукции

```
 interface IProductCatalog {
	id: string;
	description: string;
	category: string;
	image: string;
	title: string;
	button: string;
	price: number | null;
}
```

Пользовательские данные

```
 interface IUserData {
	id: string;
	payment: string;
	title: string;
	address: string | number;
	email: string | number;
	button: string;
	phone: number;
}
```

### Интерфейс для хранения каталога карточек с товаром

```
 interface IProductData {
	Product: IProductCatalog;
	preview: string | null;
	addProduct(product: IProductCatalog): void;
	deleteProduct(productId: string, payload: Function | null): void;
	updateProduct(product: IProductCatalog, payload: Function | null): void;
	getProducts(productId: string): IProductCatalog;
	checkValid(data: Record<keyof TProductInformation, string>): boolean;
}
```

## Интерфейс для хранения данных пользователя

```
 interface IUserData {
 getUserInfo(): TDataСustomer;
 setUserInfo(userData: IUser): void;
 checkUserValid(data:Record<keyof TDataСustomer, string>):  boolean;
}
```

Информация о продукте(товаре)

```
 type TroductInformation = Pick<IProductCatalog, 'image' | 'description' | 'category' | 'title' | 'price'>;
```

Корзина

```
 type TBasket = Pick<IProductCatalog, 'title' | 'price'>;
```

Форма для оплаты

```
 type TPaymentForm = Pick<IUserData, 'address' | 'button'>;
```

Контактная информация

```
 type TContactForm = Pick<IUserData, 'email' | 'phone' | 'button'>;
```

Завершение покупки

```
 type TSuccessfulPurchase = Pick<IProductCatalog, 'title' | 'price' | 'button'>;
```

## Архитектура приложения

Код разделен на слои MVP:

- слой представления, отвечает за отображение данных на странице.
- слой данных, отвечает за хранение и изменения данных.
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

#### Класс Component
Базовый класс для работы с компонентами (работа с DOM)



### Слой данных

#### Класс ProductData

Отвечает за хранение и логику работы с катологом товара. Конструктор класса принимает instant брокера событий.\
В полях класса хранятся:\
` _product: IProductCatalog[]` - массив объекта товаров\
 `_preview: string | null` - id товара, выбранного для просмотра в модальном окне\
` -events: IEvents` - экземпляр класса EventEmitter будет использоватся для генерации событий\

Класс предоставляет методы для взаимодейстия с данными.

`- addProduct(product: IProductCatalog): void` - добавляет один товар в массив, и вызывает события изменения массива\
`- deleteProduct(productId: string, payload: Function | null): void` - удаляет товар из массива. Если передан колбэк, то выполняет его после удаления, если нет, то вызывает событие изменения массива.\
`- updateProduct(product: IProductCatalog, payload: Function | null): void` - обновляет данные товара в массиве. Если передан колбэк, то выполняет его после удаления, если нет, то вызывает событие изменения массива.\
`- getProducts(productId: string): IProductCatalog` - возвращает товаз по ее id\
`- checkValid(data: Record<keyof TProductInformation, string>): boolean` - проверяет объект с данными товара на валидность.
- а так же сеттеры и геттеры для сохранения и получения данных из полей класса.

  #### класс UserData

Отвечает за хранение и логику работы с данными пользователя.\
Конструктор класса принимает instant брокера србытий\
  В полях класса хранятся:

`- _id: string` - уникальный идентификатор\
`- payment: string` - оплата товара\
`- title: string` - текст\
`- address: string | number` - адрес покупателя\
`- email: string | number` - email поккупателя\
`- phone: number` - номер контактных ланных\
`- button: string `- кнопка для отправления данных

Класс предоставляет набор методов для взаимодействия с данными:

`- getUserInfo(): TDataСustomer` - возвращает данные покупателя\
`- setUserInfo(userData: IUser): void `- сохраняет данные пользователя\
`- checkUserValid(data:Record<keyof TDataСustomer, string>): boolean `- проверяет объект с данными на .
  
	### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Modal
Pасширяет базовый класс `Component`
Реализует модальное окно.\
 Предоставляет методы `open` и `close` они открывают и закрывают модальные окна.
- `set` - заменяет содержимое модального окна. Устанавливает слушатель на клик для закрытия модального окна в оверлей и кнопку-крестик
- `render` — передает данные о контенте.

Поля класса
- `modal`: HTMLElement - элемент модального окна
- `events`: IEvents - брокер событий

#### Класс ProductCatalog
Отвечает за отображение товара, задавая в карточке товара данные названия, изображения, стоимость. Класс используется для отображения карточек товара на странице сайта. В конструктор класса передается DOM элемент темплейта. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.

#### Класс UserInfo
Отвечает за блок сайта с информацией о пользователе, содержит кнопки редактирования данных пользователя. Принимает в конструктор контейнер - элемент разметки блока для инициации событий при нажатии пользователем на кнопки. Устанавливает в конструкторе слушатели на все кнопки, при срабатывании которых генерируются соответствующие события

#### Класс Basket
Класс отвечает за отправление товара в карзину.
Конструктор принимает родительский элемент и обработчик событий.
set -  обновляет содержимое элемента и включает или отключает кнопку в зависимости от того, есть ли элементы в списке.\
`- title: string` - описание\
`-	button: string` - кнопка для оплаты\
`-	price: number | null` - цена покупки\
`-  button: string` - оформить

#### Класс PaymentForm 
класс отвечает за форму для оплаты.\
Он включает в себя выбор оплаты и поле для ввода адреса доставки, при неверном запонение выскакивает сообщение об ошибке.\
`- address: string | number` - алрес доставки\
`- button: string` - далее

#### Класс ContactForm
Включает в себя информацию о контактах покупателя, при неверном заполнение выскакивает ошибка\
`- email: string | number` - email покупателя\
`-	phone: number` - контактный номер покупателя\
`- button: string `- оплатить

#### Класс SuccessfulPurchase
включает в себя форму списание счета и успешной покупки\
`- title: string` - текст о завершение оплаты\
`-	price: number | null` - списанные синапсы\
`-	button: string` - за новыми покупками

### Слой коммуникации

#### Класс ProductApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле index.ts, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в index.ts\
В index.ts сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.
- `user:changed` - изменение данных пользователя
- `cards:changed` - изменение массива карточек продукта
- `card":selected` - изменение открываемой в модальном окне картинки продукта
- `card"previewClear` - необходима очистка данных выбранной для показа в модальном окне продукта
- `userEdit:open` - открытие модального окна с формой редактирования данных покупателя
- `card":select` - выбор карточки товара для отображения в модальном окне
- `card":delete` - выбор карточки товара для удаления
- `order-profile:input` - изменение данных в форме оплаты пользователя
- `address-profile:input` - ввод адреса пользователя в модальном окне
- `еmail-contacts:validation` - ввод Email пользователя в модальном окне
- `phone-contacts:input` - ввод номера телефона пользователя в модальном окне